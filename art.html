<!doctype html>
<html lang="en">
<head>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Averia+Sans+Libre:ital,wght@0,300;0,400;0,700;1,300;1,400;1,700&display=swap" rel="stylesheet">
  
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no" />
  <title>alice's website</title>
  <link rel="icon" type="image/png" href="assets/img/icon.png" />
  
  <!-- Preload favicon for all pages -->
  <link rel="preload" as="image" href="assets/img/icon.png">
  
  <!-- Preload critical carousel images -->
  <link rel="preload" as="image" href="assets/img/postcards/postcard1.JPG">
  <link rel="preload" as="image" href="assets/img/felting/felting2.jpg">
  <link rel="preload" as="image" href="assets/img/photos/photo2.jpg">
  
  <link rel="stylesheet" href="styles.css" />

  <style>
    body {
      overflow: auto !important; /* Enable scrolling on art page */
    }

    /* Make header take up space on small screens */
    @media (max-width: 1200px) {
      header {
        position: static !important; /* Override fixed positioning */
        padding: 40px 80px;
      }
      
      main {
        margin-top: 0 !important; /* Remove top margin since header takes space */
      }

      main > div:first-child h1 {
        margin-top: 14.2px !important; /* Remove top margin since header takes space */
      }
    }

    /* Smooth scrolling */
    html {
      scroll-behavior: smooth;
    }

    main {
      max-width: 500px;
    }

    .carousel-container {
      position: relative;
      display: flex;
      align-items: center;
      width: 100%;
    }
    
    .carousel-slide {
      width: 100%;
      max-width: 100%;
      position: relative;
      aspect-ratio: 6/4; 
      overflow: hidden;
      /* Disable double-tap zoom on the slide container */
      touch-action: manipulation;
      user-select: none;
    }

    .carousel-slide.vertical {
        aspect-ratio: 3/4;
    }

    .carousel-slide img {
      width: 100%;
      height: 100%;
      object-fit: cover; 
      object-position: center; 
      border-radius: 4px;
      /* Disable double-tap zoom and improve touch experience */
      touch-action: manipulation;
      user-select: none;
      -webkit-user-select: none;
      -webkit-touch-callout: none;
    }

    .carousel-nav {
      position: absolute;
      top: 50%;
      transform: translateY(-50%);
      border: none;
      width: 45px;
      height: 80px;
      cursor: pointer;
      font-size: 25px;
      color: #5b5c4e;
      background:none;
      /* Disable double-tap zoom on navigation buttons */
      touch-action: manipulation;
      user-select: none;
      -webkit-user-select: none;
      -webkit-touch-callout: none;
    }

    .carousel-prev {
      left: -50px;
    }

    .carousel-next {
      right: -50px; 
    }

    /* Mobile carousel adjustments */
    @media (max-width: 500px) {
      .carousel-container {
        position: relative;
        /* Remove side margins to keep carousel centered */
      }
      
      .carousel-nav {
        width: 30px;
      }
      .carousel-prev {
      left: -30px;

    }

    .carousel-next {
      right: -30px; 
    }

    .carousel-text{
        font-size: 0.8rem;
    }

    main > div:first-child h1 {
        margin-top: 20px !important; /* Remove top margin since header takes space */
      }
    }


    .carousel-text {
      text-align: right;
      margin-top: 5px;
      margin-bottom:20px;
      font-size: 0.9rem;
      color: #666;
      font-style: italic;
    }

    .art-description {
      text-align: center;
      margin-top:10px;
    }

    img {
        width: 100%;
        height: auto;
        border-radius: 4px;
    }

    /* Loading state styles */
    .carousel-image {
      transition: opacity 0.3s ease;
    }

    .carousel-text.loading {
      color: #999;
      font-style: italic;
    }

    .carousel-slide.loading::after {
      content: "";
      position: absolute;
      top: 50%;
      left: 50%;
      width: 20px;
      height: 20px;
      margin: -10px 0 0 -10px;
      border: 2px solid #f3f3f3;
      border-top: 2px solid #5b5c4e;
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

  </style>
</head>

<body>
    <header>
        <div class="logo"><a href="">Alice Zhang</a></div>
        <nav>
        <a href="art.html">Art</a>  <a href="work.html">Work</a>  <a href="mailto:alice.zhang@psy.ox.ac.uk"><img src="assets/img/email.png" alt="Email" class="email-icon"></a>
        </nav>
    </header>

  <main>  
    <div id="postcards">
        <h1>Postcards</h1>  
        <p class="art-description">A series of en plein air postcards from my travels.</br> Made with acrylic paint pens, color pencil, pencil, and pen.</p>
        <div class="carousel-container" data-carousel="postcards">
            <button class="carousel-nav carousel-prev">‹</button>
            <div class="carousel-slide">
                <img class="carousel-image" src="" alt="">
            </div>
            <button class="carousel-nav carousel-next">›</button>
        </div>
        <p class="carousel-text"></p>
    </div>
    <div id="illustration">
        <h1>Illustration</h1>  
        <p class="art-description">Digital drawings made with Procreate.</p>
        <img src="assets/img/illustrations/illustration1.png" alt="illustration1" />
        <p class="carousel-text">For long distance friends who love the moon (2023)</p>
        <img src="assets/img/illustrations/illustration2.png" alt="illustration2" />
        <p class="carousel-text">Halloween figure drawing (2024)</p>
    </div>
    <div id="felting">
        <h1>Felting adventures</h1>  
        <p class="art-description">Making wearable items out of wool roving. </br> Using needle felting and wet felting techniques.</p>
        <div class="carousel-container" data-carousel="felting">
            <button class="carousel-nav carousel-prev">‹</button>
            <div class="carousel-slide vertical">
                <img class="carousel-image" src="" alt="">
            </div>
            <button class="carousel-nav carousel-next">›</button>
        </div>
        <p class="carousel-text"></p>
    </div>
    <div id="photos">
        <h1>Film photos</h1>  
        <p class="art-description">I shoot on a Pentax K1000 and sometimes do darkroom stuff.</p>
        <div class="carousel-container" data-carousel="photos">
            <button class="carousel-nav carousel-prev">‹</button>
            <div class="carousel-slide">
                <img class="carousel-image" src="" alt="">
            </div>
            <button class="carousel-nav carousel-next">›</button>
        </div>
        <p class="carousel-text"></p>
    </div>
    <div id="painting">
        <h1>Painting</h1>  
        <p class="art-description">Acrylic painting my first love <3.</p>
        <img src="assets/img/painting/painting1.jpg" alt="painting1" />
        <p class="carousel-text">Up late in Central Square (2021)</p>
    </div>
  </main>

  <script>
    // Carousel data
    const carouselData = {
      postcards: [
        {
          image: "assets/img/postcards/postcard1.JPG",
          description: "Oeschinensee Lake, Switzerland (2023)"
        },
        {
          image: "assets/img/postcards/postcard2.JPG",
          description: "Tenryu-Ji Temple, Kyoto (2023)"
        },
        {
          image: "assets/img/postcards/postcard3.JPG",
          description: "Views from Glecksteinhütte (2023)"
        },
        {
          image: "assets/img/postcards/postcard4.JPG",
          description: "Ha Giang (2024)"
        },
        {
          image: "assets/img/postcards/postcard5.JPG",
          description: "The Man (2024)"
        },
        {
          image: "assets/img/postcards/postcard6.JPG",
          description: "Somerville college gardens (2025)"
        }
      ],
      felting: [
        {
          image: "assets/img/felting/felting2.jpg",
          description: "Needle felted fish earrings (2025)"
        },
        {
          image: "assets/img/felting/felting1.jpg",
          description: "Cozy house slippers inspired by Felicia Chao (2025)"
        },
        {
          image: "assets/img/felting/felting3.JPG",
          description: "Dai Bo (from Scissor Seven) sauna hat (2025)"
        },
        {
          image: "assets/img/felting/felting4.jpg",
          description: "Needle felted watermelon earrings (2025)"
        }
      ],
      photos: [
        {
          image: "assets/img/photos/photo2.jpg",
          description: "MIT student center (2020) / Kodak Gold 200"
        },
        {
          image: "assets/img/photos/photo1.jpg",
          description: "Cambridge, MA (2020) / Kodak Ultramax 400"
        },
        {
          image: "assets/img/photos/photo3.jpg",
          description: "Saint Lucia (2022) / Kodak Gold 200"
        },
        {
          image: "assets/img/photos/photo5.jpg",
          description: "Banff (2023) / Portra 400"
        },
        {
          image: "assets/img/photos/photo6.jpg",
          description: "Gowanus-core (2022) / Ilford HP5+"
        },
        {
          image: "assets/img/photos/photo8.jpg",
          description: "Gowanus-core (2023) / Portra 400"
        }
      ]
    };

    // Reusable Carousel Class
    class Carousel {
      constructor(container, data) {
        this.container = container;
        this.data = data;
        this.currentSlide = 0;
        this.totalSlides = data.length;
        this.preloadedImages = new Map(); // Cache for preloaded images
        
        // Get elements within this carousel
        this.prevBtn = container.querySelector('.carousel-prev');
        this.nextBtn = container.querySelector('.carousel-next');
        this.image = container.querySelector('.carousel-image');
        this.textElement = container.parentElement.querySelector('.carousel-text');
        
        this.init();
      }
      
      init() {
        // Preload all images
        this.preloadImages();
        
        // Bind event listeners
        this.prevBtn.addEventListener('click', () => this.prevSlide());
        this.nextBtn.addEventListener('click', () => this.nextSlide());
        
        // Add touch/swipe support
        this.setupSwipeSupport();
        
        // Set initial content
        this.updateCarousel();
      }
      
      // Preload all images for smooth transitions
      preloadImages() {
        this.data.forEach((item, index) => {
          const img = new Image();
          img.onload = () => {
            this.preloadedImages.set(item.image, img);
            // If this is the first image, show it immediately
            if (index === 0) {
              this.updateCarousel();
            }
          };
          img.onerror = () => {
            console.warn(`Failed to preload image: ${item.image}`);
          };
          img.src = item.image;
        });
      }
      
      updateCarousel() {
        const currentItem = this.data[this.currentSlide];
        
        // Use preloaded image if available
        const preloadedImg = this.preloadedImages.get(currentItem.image);
        if (preloadedImg) {
          // Image is already loaded, update immediately
          this.image.src = preloadedImg.src;
          this.image.alt = currentItem.description;
          this.textElement.textContent = currentItem.description;
          this.textElement.classList.remove('loading');
          this.container.querySelector('.carousel-slide').classList.remove('loading');
        } else {
          // Image not preloaded, load it properly before updating text
          const tempImg = new Image();
          
          // Show loading state
          this.textElement.textContent = "Loading...";
          this.textElement.classList.add('loading');
          this.container.querySelector('.carousel-slide').classList.add('loading');
          
          tempImg.onload = () => {
            // Only update if this is still the current slide (user hasn't clicked away)
            if (this.data[this.currentSlide] === currentItem) {
              this.image.src = tempImg.src;
              this.image.alt = currentItem.description;
              this.textElement.textContent = currentItem.description;
              this.textElement.classList.remove('loading');
              this.container.querySelector('.carousel-slide').classList.remove('loading');
              // Cache the loaded image for future use
              this.preloadedImages.set(currentItem.image, tempImg);
            }
          };
          
          tempImg.onerror = () => {
            // Only update if this is still the current slide
            if (this.data[this.currentSlide] === currentItem) {
              this.textElement.textContent = "Failed to load image";
              this.textElement.classList.remove('loading');
              this.container.querySelector('.carousel-slide').classList.remove('loading');
              console.warn(`Failed to load image: ${currentItem.image}`);
            }
          };
          
          tempImg.src = currentItem.image;
        }
      }
      
      // Setup touch/swipe support for mobile devices
      setupSwipeSupport() {
        let startX = 0;
        let startY = 0;
        let endX = 0;
        let endY = 0;
        let isPointerDown = false;
        
        const slideElement = this.container.querySelector('.carousel-slide');
        
        // Handle both touch and mouse events for broader compatibility
        const startEvents = ['touchstart', 'mousedown'];
        const moveEvents = ['touchmove', 'mousemove'];
        const endEvents = ['touchend', 'mouseup'];
        
        // Start of touch/drag
        startEvents.forEach(event => {
          slideElement.addEventListener(event, (e) => {
            isPointerDown = true;
            const pointer = e.touches ? e.touches[0] : e;
            startX = pointer.clientX;
            startY = pointer.clientY;
            
            // Prevent default behavior for touch events to avoid scrolling
            if (e.touches) {
              e.preventDefault();
            }
          }, { passive: false });
        });
        
        // During touch/drag movement
        moveEvents.forEach(event => {
          slideElement.addEventListener(event, (e) => {
            if (!isPointerDown) return;
            
            const pointer = e.touches ? e.touches[0] : e;
            endX = pointer.clientX;
            endY = pointer.clientY;
            
            // Prevent default to avoid page scrolling during horizontal swipes
            const deltaX = Math.abs(endX - startX);
            const deltaY = Math.abs(endY - startY);
            
            if (deltaX > deltaY && e.touches) {
              e.preventDefault();
            }
          }, { passive: false });
        });
        
        // End of touch/drag
        endEvents.forEach(event => {
          slideElement.addEventListener(event, (e) => {
            if (!isPointerDown) return;
            isPointerDown = false;
            
            const deltaX = endX - startX;
            const deltaY = endY - startY;
            const absDeltaX = Math.abs(deltaX);
            const absDeltaY = Math.abs(deltaY);
            
            // Only trigger swipe if horizontal movement is greater than vertical
            // and the swipe distance is significant enough
            if (absDeltaX > absDeltaY && absDeltaX > 50) {
              if (deltaX > 0) {
                // Swipe right - go to previous slide
                this.prevSlide();
              } else {
                // Swipe left - go to next slide
                this.nextSlide();
              }
            }
            
            // Reset values
            startX = 0;
            startY = 0;
            endX = 0;
            endY = 0;
          });
        });
        
        // Handle touch cancel events
        slideElement.addEventListener('touchcancel', () => {
          isPointerDown = false;
          startX = 0;
          startY = 0;
          endX = 0;
          endY = 0;
        });
      }
      
      nextSlide() {
        this.currentSlide = (this.currentSlide + 1) % this.totalSlides;
        this.updateCarousel();
      }
      
      prevSlide() {
        this.currentSlide = (this.currentSlide - 1 + this.totalSlides) % this.totalSlides;
        this.updateCarousel();
      }
      
      // Check if this carousel is currently visible on screen
      isInViewport() {
        const rect = this.container.getBoundingClientRect();
        const windowHeight = window.innerHeight;
        const windowWidth = window.innerWidth;
        
        return (
          rect.top < windowHeight * 0.8 && 
          rect.bottom > windowHeight * 0.2 &&
          rect.left < windowWidth &&
          rect.right > 0
        );
      }
    }

    // Store carousel instances
    let carousels = [];

    // Initialize all carousels
    document.addEventListener('DOMContentLoaded', () => {
      const carouselContainers = document.querySelectorAll('[data-carousel]');
      
      carouselContainers.forEach(container => {
        const carouselType = container.dataset.carousel;
        const data = carouselData[carouselType];
        
        if (data) {
          const carousel = new Carousel(container, data);
          carousels.push(carousel);
        }
      });
      
      // Initialize side navigation
      initSideNavigation();
      
      // Global keyboard navigation - affects only the visible carousel
      document.addEventListener('keydown', (e) => {
        if (e.key === 'ArrowLeft' || e.key === 'ArrowRight') {
          // Find the carousel that's most visible on screen
          const visibleCarousel = carousels.find(carousel => carousel.isInViewport());
          
          if (visibleCarousel) {
            if (e.key === 'ArrowLeft') {
              visibleCarousel.prevSlide();
            } else if (e.key === 'ArrowRight') {
              visibleCarousel.nextSlide();
            }
          }
        }
      });
    });

    // Side Navigation Functionality
    function initSideNavigation() {
      const navLinks = document.querySelectorAll('.nav-link');
      const sections = document.querySelectorAll('main > div[id]');
      
      // Update active nav item based on scroll position
      function updateActiveNav() {
        let currentSection = '';
        const scrollPosition = window.scrollY + 100; // Offset for better detection
        
        sections.forEach(section => {
          const sectionTop = section.offsetTop;
          const sectionHeight = section.offsetHeight;
          
          if (scrollPosition >= sectionTop && scrollPosition < sectionTop + sectionHeight) {
            currentSection = section.getAttribute('id');
          }
        });
        
        // Update active class
        navLinks.forEach(link => {
          link.classList.remove('active');
          if (link.getAttribute('href') === `#${currentSection}`) {
            link.classList.add('active');
          }
        });
      }
      
      // Listen for scroll events
      window.addEventListener('scroll', updateActiveNav);
      
      // Set initial active state
      updateActiveNav();
    }
  </script>
</body>
</html>
